<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Gerenciamento de Usuários</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #f8f9fa; margin: 0; }
    .container { max-width: 700px; margin: 40px auto; background: #fff; padding: 32px 24px 24px 24px; border-radius: 8px; box-shadow: 0 2px 8px #0001; }
    h2 { text-align: center; margin-bottom: 24px; }
    form { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
    form input { flex: 1 1 200px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    form button { padding: 8px 24px; border: none; border-radius: 4px; background: #007bff; color: #fff; cursor: pointer; }
    form button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { padding: 10px 8px; border: 1px solid #ddd; text-align: left; }
    th { background: #343a40; color: #fff; }
    tr:nth-child(even) { background: #f2f2f2; }
    .actions button { margin-right: 6px; padding: 4px 12px; border: none; border-radius: 4px; cursor: pointer; }
    .edit-btn { background: #ffc107; color: #212529; }
    .edit-btn:hover { background: #e0a800; }
    .delete-btn { background: #dc3545; color: #fff; }
    .delete-btn:hover { background: #b52a37; }
    @media (max-width: 600px) {
      .container { padding: 12px; }
      form { flex-direction: column; gap: 8px; }
      th, td { font-size: 14px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Gerenciamento de Usuários</h2>
    <form id="usuario-form">
      <input type="text" id="nome" placeholder="Nome" required>
      <input type="text" id="email" placeholder="Descrição e WhatsApp" required>
      <button type="submit" id="submit-btn">Adicionar</button>
    </form>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>E-mail</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="usuarios-tbody">
        <!-- Usuários serão inseridos aqui -->
      </tbody>
    </table>
  </div>
  <script>
    const API_URL = "https://ferias-api-rest.onrender.com/usuarios";
    const form = document.getElementById('usuario-form');
    const nomeInput = document.getElementById('nome');
    const emailInput = document.getElementById('email');
    const submitBtn = document.getElementById('submit-btn');
    const tbody = document.getElementById('usuarios-tbody');
    let editId = null;

    // Buscar e exibir usuários
    async function fetchUsuarios() {
      const res = await fetch(API_URL);
      const usuarios = await res.json();
      tbody.innerHTML = '';
      if (usuarios.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">Nenhum usuário cadastrado.</td></tr>`;
        return;
      }
      usuarios.forEach(usuario => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${usuario._id}</td>
          <td>${usuario.nome}</td>
          <td>${usuario.email}</td>
          <td class="actions">
            <button class="edit-btn">Editar</button>
            <button class="delete-btn">Excluir</button>
          </td>
        `;
        // Editar
        tr.querySelector('.edit-btn').onclick = () => {
          editId = usuario._id;
          nomeInput.value = usuario.nome;
          emailInput.value = usuario.email;
          submitBtn.textContent = "Atualizar";
        };
        // Excluir
        tr.querySelector('.delete-btn').onclick = async () => {
          if (confirm("Tem certeza que deseja excluir este usuário?")) {
            await fetch(`${API_URL}/${usuario._id}`, { method: "DELETE" });
            fetchUsuarios();
            if (editId === usuario._id) {
              editId = null;
              form.reset();
              submitBtn.textContent = "Adicionar";
            }
          }
        };
        tbody.appendChild(tr);
      });
    }

    // Adicionar ou atualizar usuário
    form.onsubmit = async (e) => {
      e.preventDefault();
      const nome = nomeInput.value.trim();
      const email = emailInput.value.trim();
      if (!nome || !email) return;

      if (editId) {
        // Atualizar
        await fetch(`${API_URL}/${editId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome, email })
        });
        editId = null;
        submitBtn.textContent = "Adicionar";
      } else {
        // Adicionar
        await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome, email })
        });
      }
      form.reset();
      fetchUsuarios();
    };

    // Inicializar
    fetchUsuarios();
  </script>
</body>
</html>